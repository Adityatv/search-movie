<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CRIXZY MOVIES</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.tailwindcss.com"></script>

<style>
body {
  background:#020617;
  font-family: Inter, Arial, sans-serif;
}
</style>
</head>

<body class="text-slate-100">

<main class="max-w-7xl mx-auto px-4 py-6">
  <input
    id="searchInput"
    class="w-full p-4 rounded-xl bg-slate-900 border border-white/10"
    placeholder="Search movies..."
  />

  <div
    id="movieGrid"
    class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mt-6">
  </div>
</main>

<script>
let allMovies = [];

/* ===== LOAD MOVIES ===== */
fetch("movies.json")
.then(res => res.json())
.then(data => {
  allMovies = data;
  render(allMovies.slice(0, 20));
});

/* ===== TELEGRAM SHARE (FIXED) ===== */
function openTelegramShare(movieName) {
  const message = `/movie ${movieName}`;
  const text = encodeURIComponent(message);

  const tgApp = `tg://share?text=${text}`;
  const tgWeb = `https://t.me/share/url?text=${text}`;

  // Try Telegram app
  window.location.href = tgApp;

  // Fallback to web
  setTimeout(() => {
    window.open(tgWeb, "_blank");
  }, 500);
}

/* ===== RENDER ===== */
function render(list) {
  movieGrid.innerHTML = list.map(m => {
    const name = Array.isArray(m) ? m[1] : m.name;

    return `
      <div class="bg-slate-900 p-5 rounded-2xl border border-white/10">
        <h3 class="font-bold mb-4">${name}</h3>
        <button
          onclick="openTelegramShare('${name.replace(/'/g, "\\'")}')"
          class="w-full bg-white text-black font-black py-3 rounded-xl active:scale-95">
          Get File
        </button>
      </div>
    `;
  }).join("");
}

/* ===== SEARCH ===== */
searchInput.addEventListener("input", e => {
  const q = e.target.value.toLowerCase();
  const results = allMovies.filter(m =>
    (Array.isArray(m) ? m[1] : m.name)
      .toLowerCase()
      .includes(q)
  );
  render(results.slice(0, 40));
});
</script>

</body>
</html>
